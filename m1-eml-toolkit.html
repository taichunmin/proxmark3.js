<!doctype html><html lang="zh-Hant"><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>Mifare 1k EML 工具</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><meta content="Mifare 1k EML 工具" property="og:description"><meta content="zh_TW" property="og:locale"><meta content="Mifare 1k EML 工具" property="og:title"><meta content="website" property="og:type"><meta content="https://taichunmin.idv.tw/proxmark3.js/m1-eml-toolkit.html" property="og:url"><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:"Noto Sans TC",sans-serif}</style></head><body><div class="container my-3 text-monospace" id="app" v-cloak><h3 class="mb-3 text-center">Mifare 1k EML 工具</h3><div class="form-group"><label class="mb-1">PM3 emulator memory</label><div class="d-flex"><button @click="btnReadFlash" class="btn mr-1 btn-success">讀取資料</button><button @click="btnVerifyFlash" class="btn mr-1 btn-primary">比對資料</button><button @click="btnWriteFlash" class="btn mr-1 btn-danger">寫入模擬</button></div></div><div class="form-group"><label class="mb-1">Magic Card: UID</label><div class="d-flex"><button @click="btnReadGen1a" class="btn mr-1 btn-success">讀取資料</button><button @click="btnVerifyGen1a" class="btn mr-1 btn-primary">比對資料</button><button @click="btnWriteGen1a" class="btn mr-1 btn-danger">寫入資料</button></div></div><div class="form-group"><label class="mb-1">Magic Card: CUID, FUID, UFUID</label><div class="d-flex"><button @click="btnReadGen2" class="btn mr-1 btn-success">讀取資料</button><button @click="btnVerifyGen2" class="btn mr-1 btn-primary">比對資料</button><button @click="btnWriteGen2" class="btn mr-1 btn-danger">寫入資料</button></div></div><div class="form-group"><label class="mb-1">Common</label><div class="d-flex"><button @click="btnLoadKeysFromEml" class="btn mr-1 btn-success">從 EML 提取 keys</button><button @click="btnSetBlankEml" class="btn mr-1 btn-warning">設定成空白 EML</button></div></div><div class="d-flex mx-n1"><div class="form-group mx-1" style="flex:12"><label>M1 卡的 keys</label><textarea class="form-control form-control-sm" rows="65" v-model="h.keys"></textarea></div><div class="form-group mx-1" style="flex:32"><label>M1 卡的 EML</label><textarea class="form-control form-control-sm" rows="65" v-model="h.eml"></textarea></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/proxmark3.js/proxmark3.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/proxmark3.js/plugin/Hf14a.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/proxmark3.js/plugin/LoggerRxTx.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/proxmark3.js/plugin/Waveshare.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/proxmark3.js/plugin/WebserialAdapter.min.js" crossorigin="anonymous"></script><script>const{Packet,Proxmark3}=window.Proxmark3,pm3=new Proxmark3;pm3.use(new window.Pm3WebserialAdapter),pm3.use(new window.Pm3Hf14a),window.vm=new Vue({el:"#app",data:{h:{eml:"",keys:""}},async mounted(){try{var t=JSON5.parse(localStorage.getItem(location.pathname));t&&this.$set(this,"h",{...this.h,...t})}catch(t){}this.$watch("h",()=>{localStorage.setItem(location.pathname,JSON5.stringify(this.h))},{deep:!0})},computed:{card(){try{var t=Packet.fromHex(this.h.eml);if(Packet.isLen(t,1024))return t;throw new TypeError("invalid M1 card")}catch(t){return null}},cardKeys(){const e=[];if(!this.card)return e;for(let t=0;t<16;t++)e.push(this.card.subarray(64*t+48,64*t+54)),e.push(this.card.subarray(64*t+58,64*t+64));return pm3.$hf14a.mfKeysUniq(e)},keys(){const t=Packet.fromHex(this.h.keys);return t.length%6?null:pm3.$hf14a.mfKeysUniq(t.chunk(6))}},methods:{async btnReadFlash(){try{this.showLoading("請稍候","正在從 PM3 讀取"),this.setCard(await pm3.$hf14a.mfEmlReadCard()),await Swal.fire({icon:"success",title:"讀取成功"})}catch(t){console.error(t),await Swal.fire({icon:"error",title:"讀取失敗",text:t.message})}},async btnVerifyFlash(){try{this.showLoading("請稍候","正在從 PM3 讀取");const t=await pm3.$hf14a.mfEmlReadCard();if(console.log({card:this.card,other:t}),!t.isEqual(this.card))throw new Error("卡片資料不同");await Swal.fire({icon:"success",title:"卡片資料相同"})}catch(t){console.error(t),await Swal.fire({icon:"error",title:"比對失敗",text:t.message})}},async btnWriteFlash(){try{if(!Packet.isLen(this.card,1024))throw new TypeError("EML 資料有誤");await this.confirm("即將覆蓋 PM3 記憶體資料，是否繼續？","繼續","取消")&&(this.showLoading("請稍候","正在寫入 PM3 並模擬卡片"),await pm3.$hf14a.mfEmlWriteCard({data:this.card}),await pm3.$hf14a.mfSimulateCard({type:"1k"}),await Swal.fire({icon:"success",title:"模擬成功"}))}catch(t){console.error(t),await Swal.fire({icon:"error",title:"模擬失敗",text:t.message})}},async btnReadGen1a(){try{this.showLoading("請稍候","正在讀取 UID 卡");var{data:t,success:e}=await pm3.$hf14a.mfReadCardGen1a();if(console.log({data:t,success:e}),this.setCard(t),64!==_.sum(e)){const a=_.filter(_.map(e,(t,e)=>[e,null][t]),_.isInteger);return await Swal.fire({icon:"error",title:a.length+" 個 block 讀取失敗",text:"失敗的 block: "+a.join()})}await Swal.fire({icon:"success",title:"讀取成功"})}catch(t){console.error(t),await Swal.fire({icon:"error",title:"讀取失敗",text:t.message})}},async btnVerifyGen1a(){try{this.showLoading("請稍候","正在讀取 UID 卡");const{data:t,success:e}=await pm3.$hf14a.mfReadCardGen1a();if(64!==_.sum(e)){const a=_.filter(_.map(e,(t,e)=>[e,null][t]),_.isInteger);return await Swal.fire({icon:"error",title:a.length+" 個 block 讀取失敗",text:"失敗的 block: "+a.join()})}if(console.log({card:this.card,other:t}),!t.isEqual(this.card))throw new Error("卡片資料不同");await Swal.fire({icon:"success",title:"卡片資料相同"})}catch(t){console.error(t),await Swal.fire({icon:"error",title:"比對失敗",text:t.message})}},async btnWriteGen1a(){try{if(!Packet.isLen(this.card,1024))throw new TypeError("EML 資料有誤");if(await this.confirm("即將覆蓋 UID 卡資料，是否繼續？","繼續","取消")){this.showLoading("請稍候","正在寫入 UID 卡");var t=await pm3.$hf14a.mfWriteCardGen1a({data:this.card});if(64!==_.sum(t)){const e=_.filter(_.map(t,(t,e)=>[e,null][t]),_.isInteger);return await Swal.fire({icon:"error",title:e.length+" 個 block 寫入失敗",text:"失敗的 block: "+e.join()})}await Swal.fire({icon:"success",title:"寫入成功"})}}catch(t){console.error(t),await Swal.fire({icon:"error",title:"寫入失敗",text:t.message})}},async btnReadGen2(){try{this.showLoading("請稍候","正在讀取 CUID 卡");var{success:t,data:e}=await pm3.$hf14a.mfReadCardByKeys({keys:this.keys});if(this.setCard(e),64!==_.sum(t)){const a=_.filter(_.map(t,(t,e)=>[e,null][t]),_.isInteger);return await Swal.fire({icon:"error",title:a.length+" 個 block 讀取失敗",text:"失敗的 block: "+a.join()})}await Swal.fire({icon:"success",title:"讀取成功"})}catch(t){console.error(t),await Swal.fire({icon:"error",title:"讀取失敗",text:t.message})}},async btnVerifyGen2(){try{this.showLoading("請稍候","正在讀取 CUID 卡");const{data:t,success:e}=await pm3.$hf14a.mfReadCardByKeys({keys:this.keys});if(64!==_.sum(e)){const a=_.filter(_.map(e,(t,e)=>[e,null][t]),_.isInteger);return await Swal.fire({icon:"error",title:a.length+" 個 block 讀取失敗",text:"失敗的 block: "+a.join()})}if(console.log({card:this.card,other:t}),!t.isEqual(this.card))throw new Error("卡片資料不同");await Swal.fire({icon:"success",title:"卡片資料相同"})}catch(t){console.error(t),await Swal.fire({icon:"error",title:"比對失敗",text:t.message})}},async btnWriteGen2(){try{if(!this.card)throw new TypeError("EML 資料有誤");if(await this.confirm("即將覆蓋 CUID 卡資料，是否繼續？","繼續","取消")){this.showLoading("請稍候","正在寫入 CUID 卡");var t=await pm3.$hf14a.mfWriteCardByKeys({keys:this.keys,data:this.card});if(64!==_.sum(t)){const e=_.filter(_.map(t,(t,e)=>[e,null][t]),_.isInteger);return await Swal.fire({icon:"error",title:e.length+" 個 block 寫入失敗",text:"失敗的 block: "+e.join()})}await Swal.fire({icon:"success",title:"寫入成功"})}}catch(t){console.error(t),await Swal.fire({icon:"error",title:"寫入失敗",text:t.message})}},async btnLoadKeysFromEml(){try{this.setKeys([...this.cardKeys,...Packet.fromHex("FFFFFFFFFFFF 000000000000 A0A1A2A3A4A5 D3F7D3F7D3F7").chunk(6)])}catch(t){console.error(t),await Swal.fire({icon:"error",title:"發生錯誤",text:t.message})}},async btnSetBlankEml(){if(await this.confirm("即將設定成空白 EML，是否繼續？","繼續","取消")){const a=new Packet(1024);a.set(Packet.fromHex("0102030404080400000000000000BEAF"),0);var e=Packet.fromHex("FFFFFFFFFFFF08778F00FFFFFFFFFFFF");for(let t=0;t<16;t++)a.set(e,64*t+48);this.setCard(a)}},setCard(t){if(!Packet.isLen(t,1024))throw new TypeError("invalid card");this.$set(this.h,"eml",_.map(t.chunk(16),"hex").join("\n"))},setKeys(t){t=_.map(pm3.$hf14a.mfKeysUniq(t),"hex").join("\n"),this.$set(this.h,"keys",t)},async confirm(t,e,a){return(await Swal.fire({cancelButtonColor:"#3085d6",cancelButtonText:a,confirmButtonColor:"#d33",confirmButtonText:e,focusCancel:!0,icon:"warning",showCancelButton:!0,text:t}))?.isConfirmed},showLoading(t,e){Swal.fire({title:t,text:e,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{Swal.showLoading()}})}}});</script></body></html>